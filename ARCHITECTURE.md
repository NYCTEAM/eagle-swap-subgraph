# Eagle Swap Subgraph æ¶æ„è¯´æ˜

## ğŸ—ï¸ æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        BSC åŒºå—é“¾ç½‘ç»œ                              â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ PancakeSwap  â”‚  â”‚ PancakeSwap  â”‚  â”‚   å…¶ä»– DEX   â”‚          â”‚
â”‚  â”‚   V2 Pools   â”‚  â”‚   V3 Pools   â”‚  â”‚    (æœªæ¥)    â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚         â”‚                 â”‚                  â”‚                   â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                           â”‚                                       â”‚
â”‚                    [äº‹ä»¶å‘å°„]                                     â”‚
â”‚                           â”‚                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ä½ çš„æœåŠ¡å™¨ (æœ¬åœ°)                                â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              BSC Archive å…¨å½’æ¡£èŠ‚ç‚¹                        â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  â€¢ å½“å‰åŒºå—: 76,184,704                                    â”‚  â”‚
â”‚  â”‚  â€¢ åŒæ­¥é€Ÿåº¦: 5.50 å—/ç§’                                    â”‚  â”‚
â”‚  â”‚  â€¢ ç«¯å£: 8545                                              â”‚  â”‚
â”‚  â”‚  â€¢ ç±»å‹: Archive (æ”¯æŒå†å²çŠ¶æ€æŸ¥è¯¢)                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                            â”‚                                     â”‚
â”‚                            â”‚ RPC è°ƒç”¨                            â”‚
â”‚                            â–¼                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    Graph Node                             â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  â€¢ ç›‘å¬åŒºå—é“¾äº‹ä»¶                                          â”‚  â”‚
â”‚  â”‚  â€¢ å¤„ç†æ™ºèƒ½åˆçº¦äº‹ä»¶                                        â”‚  â”‚
â”‚  â”‚  â€¢ æ‰§è¡Œæ•°æ®æ˜ å°„é€»è¾‘                                        â”‚  â”‚
â”‚  â”‚  â€¢ ç«¯å£: 8100 (HTTP), 8101 (WS)                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                            â”‚                                     â”‚
â”‚                            â”‚ å†™å…¥æ•°æ®                            â”‚
â”‚                            â–¼                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                  PostgreSQL æ•°æ®åº“                         â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  â€¢ å­˜å‚¨æ‰€æœ‰æµåŠ¨æ€§æ± æ•°æ®                                    â”‚  â”‚
â”‚  â”‚  â€¢ å­˜å‚¨äº¤æ˜“å†å²                                            â”‚  â”‚
â”‚  â”‚  â€¢ å­˜å‚¨ä»·æ ¼å†å²                                            â”‚  â”‚
â”‚  â”‚  â€¢ ç«¯å£: 5433                                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                            â”‚                                     â”‚
â”‚                            â”‚ GraphQL æŸ¥è¯¢                        â”‚
â”‚                            â–¼                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                  GraphQL API                              â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  â€¢ æä¾›æŸ¥è¯¢æ¥å£                                            â”‚  â”‚
â”‚  â”‚  â€¢ æ”¯æŒå¤æ‚è¿‡æ»¤å’Œæ’åº                                      â”‚  â”‚
â”‚  â”‚  â€¢ å®æ—¶æ•°æ®è®¿é—®                                            â”‚  â”‚
â”‚  â”‚  â€¢ URL: http://localhost:8100/subgraphs/...              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                            â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ HTTP è¯·æ±‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Eagle Swap Backend                              â”‚
â”‚                                                                   â”‚
â”‚  â€¢ æŸ¥è¯¢æµåŠ¨æ€§æ•°æ®                                                 â”‚
â”‚  â€¢ è®¡ç®—æœ€ä¼˜è·¯å¾„                                                   â”‚
â”‚  â€¢ æä¾›æŠ¥ä»·æœåŠ¡                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Eagle Swap Frontend                             â”‚
â”‚                                                                   â”‚
â”‚  â€¢ æ˜¾ç¤ºä»·æ ¼                                                       â”‚
â”‚  â€¢ æ˜¾ç¤ºæµåŠ¨æ€§                                                     â”‚
â”‚  â€¢ æ‰§è¡Œäº¤æ˜“                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š æ•°æ®æµå‘

### 1. äº‹ä»¶ç›‘å¬æµç¨‹

```
PancakeSwap åˆçº¦
    â”‚
    â”‚ emit PairCreated(token0, token1, pair)
    â”‚ emit Sync(reserve0, reserve1)
    â”‚ emit Swap(...)
    â”‚
    â–¼
BSC Archive èŠ‚ç‚¹ (8545)
    â”‚
    â”‚ å­˜å‚¨äº‹ä»¶æ—¥å¿—
    â”‚
    â–¼
Graph Node
    â”‚
    â”‚ 1. ç›‘å¬æ–°åŒºå—
    â”‚ 2. æå–äº‹ä»¶æ—¥å¿—
    â”‚ 3. è°ƒç”¨æ˜ å°„å‡½æ•°
    â”‚
    â–¼
æ˜ å°„å‡½æ•° (TypeScript)
    â”‚
    â”‚ handlePairCreated()
    â”‚ handleSync()
    â”‚ handleSwap()
    â”‚
    â–¼
æ•°æ®å®ä½“ (Entity)
    â”‚
    â”‚ Token
    â”‚ Pair
    â”‚ Swap
    â”‚ Sync
    â”‚
    â–¼
PostgreSQL æ•°æ®åº“
```

### 2. æŸ¥è¯¢æµç¨‹

```
å‰ç«¯/åç«¯
    â”‚
    â”‚ GraphQL æŸ¥è¯¢
    â”‚
    â–¼
GraphQL API (8100)
    â”‚
    â”‚ è§£ææŸ¥è¯¢
    â”‚ ç”Ÿæˆ SQL
    â”‚
    â–¼
PostgreSQL æ•°æ®åº“
    â”‚
    â”‚ æ‰§è¡ŒæŸ¥è¯¢
    â”‚ è¿”å›ç»“æœ
    â”‚
    â–¼
GraphQL API
    â”‚
    â”‚ æ ¼å¼åŒ–æ•°æ®
    â”‚
    â–¼
å‰ç«¯/åç«¯
```

## ğŸ—‚ï¸ æ•°æ®åº“ç»“æ„

### æ ¸å¿ƒè¡¨

```sql
-- ä»£å¸è¡¨
tokens (
  id VARCHAR PRIMARY KEY,           -- ä»£å¸åœ°å€
  symbol VARCHAR,                   -- ç¬¦å·
  name VARCHAR,                     -- åç§°
  decimals BIGINT,                  -- ç²¾åº¦
  total_liquidity NUMERIC,          -- æ€»æµåŠ¨æ€§
  derived_usd NUMERIC,              -- USD ä»·æ ¼
  derived_bnb NUMERIC,              -- BNB ä»·æ ¼
  trade_volume_usd NUMERIC,         -- äº¤æ˜“é‡
  tx_count BIGINT                   -- äº¤æ˜“æ¬¡æ•°
)

-- V2 æ± å­è¡¨
pairs (
  id VARCHAR PRIMARY KEY,           -- æ± å­åœ°å€
  token0_id VARCHAR REFERENCES tokens(id),
  token1_id VARCHAR REFERENCES tokens(id),
  reserve0 NUMERIC,                 -- token0 å‚¨å¤‡
  reserve1 NUMERIC,                 -- token1 å‚¨å¤‡
  reserve_usd NUMERIC,              -- æ€»æµåŠ¨æ€§ (USD)
  token0_price NUMERIC,             -- ä»·æ ¼
  token1_price NUMERIC,             -- ä»·æ ¼
  volume_usd NUMERIC,               -- äº¤æ˜“é‡
  tx_count BIGINT                   -- äº¤æ˜“æ¬¡æ•°
)

-- V3 æ± å­è¡¨
pools_v3 (
  id VARCHAR PRIMARY KEY,           -- æ± å­åœ°å€
  token0_id VARCHAR REFERENCES tokens(id),
  token1_id VARCHAR REFERENCES tokens(id),
  fee_tier BIGINT,                  -- è´¹ç‡ (100, 500, 2500, 10000)
  liquidity BIGINT,                 -- æµåŠ¨æ€§
  total_value_locked_usd NUMERIC,   -- TVL
  token0_price NUMERIC,
  token1_price NUMERIC,
  volume_usd NUMERIC,
  tx_count BIGINT
)

-- äº¤æ˜“è¡¨
swaps (
  id VARCHAR PRIMARY KEY,           -- tx hash + log index
  pair_id VARCHAR REFERENCES pairs(id),
  timestamp BIGINT,
  amount0_in NUMERIC,
  amount1_in NUMERIC,
  amount0_out NUMERIC,
  amount1_out NUMERIC,
  amount_usd NUMERIC
)

-- V3 äº¤æ˜“è¡¨
swaps_v3 (
  id VARCHAR PRIMARY KEY,
  pool_id VARCHAR REFERENCES pools_v3(id),
  timestamp BIGINT,
  amount0 NUMERIC,
  amount1 NUMERIC,
  amount_usd NUMERIC,
  sqrt_price_x96 BIGINT,
  tick BIGINT
)

-- å†å²æ•°æ®è¡¨
pair_hour_data (...)
pair_day_data (...)
token_day_data (...)
```

## ğŸ” ç›‘å¬çš„æ™ºèƒ½åˆçº¦

### PancakeSwap V2

```javascript
// Factory: 0xcA143Ce32Fe78f1f7019d7d551a6402fC5350c73
{
  events: [
    "PairCreated(address indexed token0, address indexed token1, address pair, uint256)"
  ],
  startBlock: 71552000
}

// Pair (åŠ¨æ€åˆ›å»º)
{
  events: [
    "Sync(uint112 reserve0, uint112 reserve1)",
    "Swap(address indexed sender, uint256 amount0In, uint256 amount1In, uint256 amount0Out, uint256 amount1Out, address indexed to)"
  ]
}
```

### PancakeSwap V3

```javascript
// Factory: 0x0BFbCF9fa4f9C56B0F40a671Ad40E0805A091865
{
  events: [
    "PoolCreated(address indexed token0, address indexed token1, uint24 indexed fee, int24 tickSpacing, address pool)"
  ],
  startBlock: 71552000
}

// Pool (åŠ¨æ€åˆ›å»º)
{
  events: [
    "Swap(address indexed sender, address indexed recipient, int256 amount0, int256 amount1, uint160 sqrtPriceX96, uint128 liquidity, int24 tick)"
  ]
}
```

## ğŸ“ˆ æ•°æ®æ›´æ–°æ—¶åº

```
æ—¶é—´è½´ (æ¯ 3 ç§’ä¸€ä¸ªåŒºå—)
â”‚
â”œâ”€ åŒºå— N
â”‚  â”‚
â”‚  â”œâ”€ äº¤æ˜“ 1: Swap USDT â†’ TA
â”‚  â”‚  â””â”€ emit Swap(...)
â”‚  â”‚
â”‚  â”œâ”€ äº¤æ˜“ 2: Add Liquidity
â”‚  â”‚  â””â”€ emit Sync(...)
â”‚  â”‚
â”‚  â””â”€ äº¤æ˜“ 3: Swap TA â†’ WBNB
â”‚     â””â”€ emit Swap(...)
â”‚
â”œâ”€ Graph Node å¤„ç†
â”‚  â”‚
â”‚  â”œâ”€ æå–äº‹ä»¶æ—¥å¿—
â”‚  â”œâ”€ è°ƒç”¨ handleSwap()
â”‚  â”œâ”€ æ›´æ–° Pair å®ä½“
â”‚  â”œâ”€ æ›´æ–° Token å®ä½“
â”‚  â””â”€ å†™å…¥æ•°æ®åº“
â”‚
â”œâ”€ æ•°æ®åº“æ›´æ–°å®Œæˆ
â”‚  â””â”€ GraphQL æŸ¥è¯¢ç«‹å³å¯è§æ–°æ•°æ®
â”‚
â”œâ”€ åŒºå— N+1
â”‚  â””â”€ ç»§ç»­å¤„ç†...
â”‚
â””â”€ ...
```

## ğŸ¯ å®é™…åº”ç”¨åœºæ™¯

### åœºæ™¯ 1: ç”¨æˆ·è¾“å…¥äº¤æ˜“é‡‘é¢

```
ç”¨æˆ·: è¾“å…¥ "100 USDT â†’ TA"
    â†“
å‰ç«¯: è°ƒç”¨æŠ¥ä»·æœåŠ¡
    â†“
åç«¯: æŸ¥è¯¢ Subgraph
    â†“
GraphQL: 
    query {
      # æŸ¥è¯¢ USDT/TA æ‰€æœ‰æ± å­
      pairs(where: { token0: "USDT", token1: "TA" }) {
        reserveUSD
        token0Price
      }
      poolsV3(where: { token0: "USDT", token1: "TA" }) {
        totalValueLockedUSD
        token0Price
        feeTier
      }
    }
    â†“
åç«¯: è®¡ç®—æœ€ä¼˜è·¯å¾„
    â†“
å‰ç«¯: æ˜¾ç¤ºæŠ¥ä»· "100 USDT â†’ 200 TA"
```

### åœºæ™¯ 2: æ˜¾ç¤ºæµåŠ¨æ€§æ’è¡Œ

```
å‰ç«¯: è¯·æ±‚æµåŠ¨æ€§æ’è¡Œ
    â†“
GraphQL:
    query {
      pairs(
        first: 100
        orderBy: reserveUSD
        orderDirection: desc
      ) {
        token0 { symbol }
        token1 { symbol }
        reserveUSD
      }
    }
    â†“
å‰ç«¯: æ˜¾ç¤ºåˆ—è¡¨
    1. WBNB/USDT - $500M
    2. WBNB/BUSD - $300M
    3. TA/USDT - $200M
    ...
```

### åœºæ™¯ 3: ä»·æ ¼å›¾è¡¨

```
å‰ç«¯: è¯·æ±‚ TA/USDT 24å°æ—¶ä»·æ ¼
    â†“
GraphQL:
    query {
      pairHourData(
        where: { pair: "0xTA_USDT_Pair" }
        orderBy: hourStartUnix
        orderDirection: desc
        first: 24
      ) {
        hourStartUnix
        token0Price
        hourlyVolumeUSD
      }
    }
    â†“
å‰ç«¯: ç»˜åˆ¶å›¾è¡¨
```

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### 1. ç´¢å¼•ä¼˜åŒ–

```sql
-- ä»£å¸åœ°å€ç´¢å¼•
CREATE INDEX idx_tokens_address ON tokens(id);

-- æ± å­ä»£å¸ç´¢å¼•
CREATE INDEX idx_pairs_token0 ON pairs(token0_id);
CREATE INDEX idx_pairs_token1 ON pairs(token1_id);

-- æµåŠ¨æ€§æ’åºç´¢å¼•
CREATE INDEX idx_pairs_reserve_usd ON pairs(reserve_usd DESC);
CREATE INDEX idx_pools_v3_tvl ON pools_v3(total_value_locked_usd DESC);

-- æ—¶é—´åºåˆ—ç´¢å¼•
CREATE INDEX idx_swaps_timestamp ON swaps(timestamp DESC);
CREATE INDEX idx_pair_hour_data_time ON pair_hour_data(hour_start_unix DESC);
```

### 2. æŸ¥è¯¢ä¼˜åŒ–

```graphql
# âŒ ä¸æ¨è: æŸ¥è¯¢æ‰€æœ‰å­—æ®µ
query {
  pairs {
    id
    token0 { id symbol name decimals ... }
    token1 { id symbol name decimals ... }
    reserve0
    reserve1
    ...
  }
}

# âœ… æ¨è: åªæŸ¥è¯¢éœ€è¦çš„å­—æ®µ
query {
  pairs(first: 10, orderBy: reserveUSD, orderDirection: desc) {
    token0 { symbol }
    token1 { symbol }
    reserveUSD
    token0Price
  }
}
```

### 3. æ‰¹é‡æŸ¥è¯¢

```graphql
# âœ… ä¸€æ¬¡æŸ¥è¯¢å¤šä¸ªä»£å¸
query {
  token0: token(id: "0xUSDT") { derivedUSD }
  token1: token(id: "0xWBNB") { derivedUSD }
  token2: token(id: "0xTA") { derivedUSD }
}
```

## ğŸ“Š èµ„æºä½¿ç”¨ä¼°ç®—

### å­˜å‚¨ç©ºé—´

```
PostgreSQL æ•°æ®åº“:
â”œâ”€ tokens: ~10 MB (10,000 ä»£å¸)
â”œâ”€ pairs: ~50 MB (50,000 æ± å­)
â”œâ”€ pools_v3: ~30 MB (30,000 æ± å­)
â”œâ”€ swaps: ~10 GB (1000ä¸‡ äº¤æ˜“)
â”œâ”€ swaps_v3: ~5 GB (500ä¸‡ äº¤æ˜“)
â”œâ”€ pair_hour_data: ~20 GB (å†å²æ•°æ®)
â”œâ”€ pair_day_data: ~5 GB (å†å²æ•°æ®)
â””â”€ ç´¢å¼•: ~10 GB
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
æ€»è®¡: ~50 GB (æŒç»­å¢é•¿)

å»ºè®®: 500 GB SSD
```

### å†…å­˜ä½¿ç”¨

```
Graph Node: 4-8 GB
PostgreSQL: 8-16 GB
IPFS: 2-4 GB
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
æ€»è®¡: 14-28 GB

å»ºè®®: 32 GB RAM
```

### CPU ä½¿ç”¨

```
åŒæ­¥é˜¶æ®µ: 80-100% (4-8 æ ¸)
æ­£å¸¸è¿è¡Œ: 20-40% (4-8 æ ¸)

å»ºè®®: 8 æ ¸ CPU
```

## ğŸ”§ ç›‘æ§æŒ‡æ ‡

### å…³é”®æŒ‡æ ‡

```javascript
{
  // Subgraph çŠ¶æ€
  currentBlock: 76184704,           // å½“å‰ç´¢å¼•åŒºå—
  latestBlock: 76225108,            // æœ€æ–°åŒºå—
  blocksBehind: 40404,              // è½ååŒºå—æ•°
  syncSpeed: 5.5,                   // åŒæ­¥é€Ÿåº¦ (å—/ç§’)
  
  // æ•°æ®ç»Ÿè®¡
  totalTokens: 10000,               // ä»£å¸æ•°é‡
  totalPairs: 50000,                // V2 æ± å­æ•°é‡
  totalPoolsV3: 30000,              // V3 æ± å­æ•°é‡
  totalSwaps: 10000000,             // äº¤æ˜“æ•°é‡
  
  // æ€§èƒ½æŒ‡æ ‡
  queryLatency: 50,                 // æŸ¥è¯¢å»¶è¿Ÿ (ms)
  indexingRate: 100,                // ç´¢å¼•é€Ÿç‡ (äº‹ä»¶/ç§’)
  dbSize: 50,                       // æ•°æ®åº“å¤§å° (GB)
  
  // é”™è¯¯ç›‘æ§
  indexingErrors: 0,                // ç´¢å¼•é”™è¯¯
  queryErrors: 0                    // æŸ¥è¯¢é”™è¯¯
}
```

## ğŸ“ æ€»ç»“

### âœ… Subgraph èƒ½åšä»€ä¹ˆ

1. **ç´¢å¼•æ‰€æœ‰æµåŠ¨æ€§æ± **
   - V2 æ‰€æœ‰äº¤æ˜“å¯¹
   - V3 æ‰€æœ‰è´¹ç‡æ± 
   - å®æ—¶æ›´æ–°

2. **æä¾›ä¸°å¯ŒæŸ¥è¯¢**
   - ä»£å¸ä»·æ ¼
   - æµåŠ¨æ€§æ•°æ®
   - äº¤æ˜“å†å²
   - å†å²ä»·æ ¼

3. **æ”¯æŒå¤æ‚è¿‡æ»¤**
   - æŒ‰æµåŠ¨æ€§æ’åº
   - æŒ‰äº¤æ˜“é‡æ’åº
   - æŒ‰æ—¶é—´èŒƒå›´ç­›é€‰
   - å¤šæ¡ä»¶ç»„åˆ

4. **é«˜æ€§èƒ½è®¿é—®**
   - GraphQL æ¥å£
   - ç´¢å¼•ä¼˜åŒ–
   - æ‰¹é‡æŸ¥è¯¢
   - å®æ—¶æ•°æ®

### ğŸ¯ ä¸ä½ çš„ç³»ç»Ÿå®Œç¾é…åˆ

```
ä½ çš„ BSC Archive èŠ‚ç‚¹ (8545)
    â†“
Subgraph ç´¢å¼•æ‰€æœ‰æµåŠ¨æ€§
    â†“
Eagle Swap ä½¿ç”¨æ•°æ®
    â†“
ç”¨æˆ·è·å¾—æœ€ä¼˜æŠ¥ä»·
```

**æ‰€æœ‰ä»£å¸çš„æ‰€æœ‰æµåŠ¨æ€§æ± éƒ½ä¼šè¢«ç»Ÿè®¡åˆ°æ•°æ®åº“ï¼** âœ…
